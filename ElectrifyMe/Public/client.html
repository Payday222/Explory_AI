<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Client Room</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        /* Your existing styles */
    </style>
</head>
<body>

    <button id="togglePanelButton">â˜°</button>

    <div id="panel">
        <div id="panelContent">
            <h1>Student Room</h1>
            <input type="text" id="roomCodeInput" placeholder="Enter Room Code" />
            <button id="joinRoom">Join Room</button>
            <div id="status"></div>
            <input type="text" id="messageInput" placeholder="Type your message" />
            <button id="sendMessage">Send Message</button>
            <div id="receive"></div>
            <button id="saveHistory">Save history</button>
        </div>
    </div>

    <div id="rightSide">
        <div id="test">
            Test content goes here. It will be unmodifiable and read-only.
        </div>

        <div id="answers">
            <textarea id="answersTextarea" placeholder="Type your answers here..."></textarea>
            <button id="sendAnswers">Send your answers</button>
        </div>
    </div>

    <script>
        const togglePanelButton = document.getElementById('togglePanelButton');
        const panel = document.getElementById('panel');

        togglePanelButton.addEventListener('click', () => {
            panel.classList.toggle('open');
        });

        // Connect to the room server
        const socket = io('http://188.127.1.110:3005');
        let currentRoomCode = '';

        // Log connection status
        socket.on('connect', () => {
            console.log("[Client] Connected to room server");
        });

        // Handle room joining
        document.getElementById('joinRoom').onclick = () => {
            const roomCode = document.getElementById('roomCodeInput').value;
            console.log("[Client] Attempting to join room:", roomCode);
            socket.emit('joinRoom', roomCode);
        };

        // Handle successful room join
        socket.on('joinedRoom', (roomCode) => {
            console.log("[Client] Successfully joined room:", roomCode);
            currentRoomCode = roomCode;
            document.getElementById('status').innerText = `Joined Room: ${roomCode}`;
        });

        // Handle room not found
        socket.on('roomNotFound', () => {
            console.log("[Client] Room not found");
            document.getElementById('status').innerText = 'Room not found. Please check the code.';
        });

        // Handle incoming messages
        socket.on('receiveMessage', (data) => {
            console.log("[Client] Received message:", data);
            const { from, message, type } = data;

            if (type === 'testUpdate') {
                console.log("[Client] Received test update:", message);
                const testDiv = document.getElementById('test');
                testDiv.innerText = message; // Update the test div
            } else {
                // Handle regular chat message
                console.log("[Client] Received regular message:", message);
                const messageDiv = document.createElement('div');
                messageDiv.innerText = `Admin: ${message}`;
                document.getElementById('receive').appendChild(messageDiv);
            }
        });

        // Handle sending messages
        document.getElementById('sendMessage').onclick = () => {
            const message = document.getElementById('messageInput').value;
            if (currentRoomCode) {
                console.log("[Client] Sending message to room:", currentRoomCode);
                socket.emit('sendMessage', { roomCode: currentRoomCode, message });
                document.getElementById('messageInput').value = ''; 
            } else {
                console.log("[Client] No room joined. Cannot send message.");
            }
        };

        // Handle sending answers
        document.getElementById('sendAnswers').onclick = () => {
            const answers = document.getElementById('answersTextarea').value;
            if (currentRoomCode) {
                console.log("[Client] Sending answers to host:", answers);
                socket.emit('sendAnswers', { roomCode: currentRoomCode, answers });
                document.getElementById('answersTextarea').value = ''; 
            } else {
                console.log("[Client] No room joined. Cannot send answers.");
            }
        };
    </script>
</body>
</html>